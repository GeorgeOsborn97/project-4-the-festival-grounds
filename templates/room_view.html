{% extends "base.html" %}
{% load crispy_forms_tags %}
{% block nav %}
<div class="container text-center">
    <nav>
        <div class="row gy-5">
            {% if user.is_authenticated %}
            <div class="col-3">
                <button type="button" name="edit" class="btn btn-dark" data-bs-toggle="offcanvas" data-bs-target="#offcanvas" aria-controls="offcanvas">Edit Room</button>
            </div>
            <div class="col-3">
                <button type="button" name="edit" class="btn btn-dark" data-bs-toggle="offcanvas" data-bs-target="#convoOffcanvas" aria-controls="offcanvas">Start Conversation</button>
            </div>
            <div class="col-3">
                <a href="{% url 'account_logout' %}">Logout</a>
            </div>
            <div class="col-3">
                <a href="#">Your Rooms</a>
            </div>
            {% else %}
            <div class="col-4">
                <a href="{% url 'account_signup' %}">Register</a>
            </div>
            <div class="col-4">
                <a href="{% url 'account_login' %}">Login</a>
            </div>
            <div class="col-4">
                <a href="#">About</a>
            </div>
            {% endif %}
        </div>
    </nav>
    {% block header %}
    {% endblock %}
</div>
{% endblock %}

{% block cards %}

<div id="card-container" class="container text-center">
    <div id="card-row" class="row row-col-3 justify-content-md-center">
        <h1>{{ room.title }}</h1>
    </div>
</div>
<div id="card-container" class="container text-center">
    <div id="card-row" class="row row-col-3 justify-content-md-center">
        <div class="accordion" id="accordionExample">
            {% for conversation in conversation_list %}
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseOne-{{ conversation.slug }}" aria-expanded="true" aria-controls="collapseOne-{{ conversation.slug }}">
                        {{ conversation.title }}
                    </button>
                </h2>
                <div id="collapseOne-{{  conversation.slug  }}" class="accordion-collapse collapse show"
                    aria-labelledby="headingOne">
                    <div class="accordion-body">
                        <h4>{{ conversation.content | safe }}</h4>
                        {% for comment in comments %}
                        {% if comment.conversation == conversation %}
                        <p><strong>{{ comment.name }} said: </strong>{{ comment.body | safe }}</p>
                        {% endif %}
                        {% endfor %}
                        <div>
                            <form method="POST">
                                {{ comment_form | crispy }}
                                {% csrf_token %}
                                <div>
                                    <p>
                                        <button type="submit">add comment</button>
                                    </p>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        No conversations started
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne"
                    data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <p>No comments</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block canvas %}
<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvas" aria-labelledby="offcanvasLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasLabel">Edit: {{ room.title }}</h5>
      <h6 id="roomId">{{ room.id }}</h6>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <div id="liveAlertPlaceholder"></div>
        <form method="POST">
            {{ room_form | crispy }}
            {% csrf_token %}
            <div>
                <button type="submit" class="btn btn-dark">edit Room</button>
            </div>
        </form>
        <hr id="break-line">
        <div>
            {% if user == room.creator %}
            <button type="button" class="btn btn-danger" id="liveAlertBtn">Delete Room</button>
            {% endif %}
        </div>
    </div>
</div>
<div class="offcanvas offcanvas-start" tabindex="-1" id="convoOffcanvas" aria-labelledby="offcanvasLabel">
    <div class="offcanvas-header">
      <h5 class="ffcanvas-title" id="convoOffcanvasLabel">Backdrop with scrolling</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <form method="POST">
            {{ conversation_form | crispy }}
            {% csrf_token %}
            <div>
                <p>
                    <button type="submit">Start a conversation</button>
                </p>
            </div>
        </form>
    </div>
</div>
{% endblock %}